import pandas as pd

# Read the necessary Excel sheets into pandas DataFrames
excel_file = 'cleaned_data0.xlsx'
order_df = pd.read_excel(excel_file, sheet_name='Order')
order_detail_df = pd.read_excel(excel_file, sheet_name='Order_Detail')
item_df = pd.read_excel(excel_file, sheet_name='Item')

# Merge 'Order' with 'Order_Detail' to get product details
merged_order_df = pd.merge(order_df, order_detail_df, on='order_id', how='inner')

# Merge 'Order' with 'Order_Detail' to get product details
merged_df = pd.merge(merged_order_df, item_df, on='item_code', how='inner')

# Calculate the total revenue generated by each product
product_revenue = merged_df.groupby('item_code')['total_amount'].sum()

# Identify the most profitable products
most_profitable_products = product_revenue.nlargest(10)

# Create a Pandas Excel writer using XlsxWriter as the engine.
with pd.ExcelWriter('cleaned_data0.xlsx', engine='openpyxl', mode='a') as writer:
    # Write the most profitable products to a new sheet named 'Most Profitable Products'
    most_profitable_products.to_excel(writer, sheet_name='Most Profitable Products', header=True)
