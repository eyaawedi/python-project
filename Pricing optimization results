import pandas as pd

# Read the necessary Excel sheets into pandas DataFrames
excel_file = 'cleaned_data0.xlsx'
order_detail_df = pd.read_excel(excel_file, sheet_name='Order_Detail')
item_df = pd.read_excel(excel_file, sheet_name='Item')

# Merge 'Order_Detail' with 'Item' to get product details
merged_df = pd.merge(order_detail_df, item_df, on='item_code', how='inner')

# Calculate the total revenue generated by each product
product_revenue = merged_df.groupby('item_code')['selling_price'].sum()

# Calculate the total commission generated by each product
product_commission = merged_df.groupby('item_code')['commission'].sum()

# Calculate the profitability (revenue - commission) for each product
product_profitability = product_revenue - product_commission

best_strategy = 'current'

# Create a DataFrame to store the results
pricing_optimization_results = pd.DataFrame({
    'item_code': product_profitability.index,
    'total_revenue': product_revenue.values,
    'total_commission': product_commission.values,
    'profitability': product_profitability.values,
    'best_strategy': best_strategy
})

# Save the results to the same Excel file in a new sheet
with pd.ExcelWriter(excel_file, mode='a', engine='openpyxl') as writer:
    pricing_optimization_results.to_excel(writer, sheet_name='Pricing_Optimization_Results', index=False)
